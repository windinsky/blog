var dbcfg		= require('../../database/config.json'),
	config		= require('../../config.json')
	dbAdapter	= require(dbcfg.adapterPath),
	fs			= require('fs'),
	$			= require('support'),
	loaded		= false;

var load = function(){
	
	var ejs = require('ejs');
	
	if (loaded) {
		return ;
	};
	
	$.truncateFolderSync(config.modelPath);
	
	dbAdapter.config(dbcfg);
	dbAdapter.getStructure(function(structure){
		for (var i in structure){
			var klass = $.camelcase(i),
				fd = fs.openSync(config.modelPath + '/' + i + '.js','w+');
			var obj = {
				modelName: klass,
				tableName: i,
				columns: structure[i]
			}

			for (var i=0; i < obj.columns.length; i++) {
				obj.columns[i].camelname = $.camelcase(obj.columns[i].name);
			};
			str = ejs.renderFile('node_modules/model_loader/template.ejs',obj,function(err,data){
				if (err) {
					throw err;
				};
				fs.writeSync(fd,data);
			});
			
			
		}
	});
	
}

load();